<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WaldoCoin Presale</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #e63e3e;
      color: #e63e3e;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      border-radius: 10px;
    }

    header, section, footer {
      padding: 20px;
      background-color: #ffffff;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }

    h1, h2 {
      color: #333;
      text-align: center;
    }

    label, input, button {
      display: block;
      width: 100%;
      margin-top: 10px;
    }

    input, button {
      padding: 12px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      background-color: #e63e3e;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    .output {
      font-size: 16px;
      font-weight: bold;
      color: red;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      color: #ffffff;
    }

    .bonus {
      color: red;
    }

    footer {
      text-align: center;
      font-size: 14px;
      color: #666;
    }
    .telegram-link {
      color: #e63e3e;
      font-weight: bold;
      text-decoration: none;
    }
    .telegram-link:hover {
      text-decoration: underline;
    }
    .lookup-result {
      margin-top: 20px;
    }
    .wallet-search-btn {
      padding: 10px 20px;
      background: #e63e3e;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background 0.3s;
    }
    .wallet-search-btn:hover {
      background: #45a049;
    }
    #walletSearch {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
    }
    #lookupResult2 {
      margin-top: 20px;
    }
    #presaleFeed {
      list-style: none;
      padding-left: 0;
      font-weight: bold;
      color: #333;
    }
    #presaleFeedActivity {
      list-style: none;
      padding-left: 0;
      font-weight: bold;
      color: #333;
    }
    .meter-wrapper {
        margin-top: 30px;
        text-align: center;
        font-size: 1.5rem;
        color: #fff;
      }
      
      .meter {
        height: 30px;
        background: #222;
        border: 2px solid #555;
        border-radius: 15px;
        overflow: hidden;
        margin: 15px auto;
        width: 80%;
        max-width: 600px;
      }
      
      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #ff003c, #ff8c00, #ffff00);
        transition: width 1.5s ease-in-out;
      }
  .waldo-standout {
    color: #e63e3e;
    font-weight: bold;
    font-size: 2rem;
    text-shadow: 0 0 10px #e63e3e, 0 0 20px #ff4d4d;
    margin-top: 10px;
  }

  .conversion-section {
    padding: 30px;
    background: #111;
    color: #fcfcfc;
    font-family: 'Inter', sans-serif;
  }

  .conversion-section h2 {
    margin: 0 0 10px;
    font-size: 1.5em;
    color: #e63e3e;
  }

  .conversion-scroll {
    overflow-x: auto;
  }

  .conversion-table {
    width: 100%;
    border-collapse: collapse;
    background: #222;
    color: white;
    margin-top: 10px;
  }

  .conversion-table th,
  .conversion-table td {
    padding: 10px 14px;
    border: 1px solid #fcfbfb;
    text-align: left;
    white-space: nowrap;
    min-width: 140px;
  }

  .conversion-table th {
    background-color: #e63e3e;
    color: #fff;
  }

  .bonus {
    color: #ffe600;
    font-weight: bold;
    display: block;
    margin-top: 4px;
    font-size: 0.95em;
  }

  @media (max-width: 600px) {
    .conversion-section h2 {
      font-size: 1.2em;
      padding-left: 16px;
    }

    .conversion-table th,
    .conversion-table td {
      font-size: 0.95em;
      min-width: 140px;
    }

    .bonus {
      font-size: 0.9em;
    }
  }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöÄ Welcome to the WaldoCoin Presale!</h1>
      <p>Exchange your XRP for WaldoCoins at an amazing rate: 10 XRP = 1,000,000 WALDO. Big bonuses for higher purchases!</p>
    </header>

    <section class="meter-wrapper">
        <h2>üî• WALDO SOLD: <span id="waldoSold">0</span> / 75,000,000</h2>
        <div class="meter">
          <div id="progressBar" class="progress-bar"></div>
        </div>
      </section>
    <section>
      <label for="xrpAmount">Enter XRP amount (WLO is sold in blocks of 10 XRP):</label>
      <input id="xrpAmount" type="number" name="xrpAmount" min="10" max="100" step="10" value="10">
      <button type="button" onclick="calculateWaldo()">Calculate WALDO</button>
      <p id="waldoAmount" class="output waldo-standout">
  You will receive 1,000,000 WaldoCoins.
</p>

      <p>Please send your XRP to:</p>
      <p><strong>XRP Wallet:</strong> <span id="fixedWalletAddress">rnWfL48YCknW6PYewFLKfMKUymHCfj3aww</span></p>

      <label for="txId">Enter your Transaction ID:</label>
      <input id="txId" type="text" name="txId" placeholder="Transaction ID">

      <label for="userEmail">Optional Email (for confirmation):</label>
      <input id="userEmail" type="email" name="userEmail" placeholder="you@example.com">

      <button id="confirmPurchaseBtn" type="button">Confirm Purchase</button>
    </section>

<section class="conversion-section">
  <h2>üìä XRP to WALDO Conversion Chart</h2>
  <h2>(How many WALDO you get)</h2>
  <div class="conversion-scroll">
    <table class="conversion-table">
      <thead>
        <tr><th scope="col">XRP</th><th scope="col">WaldoCoins</th></tr>
      </thead>
      <tbody>
        <tr><td>10 XRP</td><td>1,000,000 WALDO</td></tr>
        <tr><td>20 XRP</td><td>2,000,000 WALDO</td></tr>
        <tr><td>30 XRP</td><td>3,000,000 WALDO</td></tr>
        <tr><td>40 XRP</td><td>4,000,000 WALDO</td></tr>
        <tr><td>60 XRP</td><td>6,000,000 WALDO</td></tr>
        <tr><td>70 XRP</td><td>7,000,000 WALDO</td></tr>
        <tr><td>80 XRP</td><td>8,000,000 WALDO <span class="bonus">+ 2,000,000 Bonus = 10,000,000 Total</span></td></tr>
        <tr><td>90 XRP</td><td>9,000,000 WALDO <span class="bonus">+ 3,000,000 Bonus = 12,000,000 Total</span></td></tr>
        <tr><td>100 XRP</td><td>10,000,000 WALDO <span class="bonus">+ 5,000,000 Bonus = 15,000,000 Total</span></td></tr>
      </tbody>
    </table>
  </div>
</section>

<section>
  <h2>üîç Wallet Lookup</h2>
  <div id="lookupResult2"></div>
  <input type="text" id="walletSearch" placeholder="Paste your wallet address...">
  <button type="button" class="wallet-search-btn" onclick="lookupWallet()">Search Wallet</button>
  <ul id="presaleFeedActivity"></ul>
  <div id="lookupResult"></div>
</section>


    <footer>
      <p>Need help? Email <strong>waldocoin@support.live</strong>
        <a href="https://t.me/WALDOmeme" target="_blank" class="telegram-link">Telegram</a>
      </p>
    </footer>
  </div>
  <script>
  const baseURL = "https://waldocoin-backend.onrender.com";
  const hardCap = 75000000;
  const endDate = new Date("2025-06-01T00:00:00Z");
  let countdownTarget = endDate.getTime();
  let countdownInterval = null;
  let presaleEnded = false;

  function startCountdownLoop() {
    clearInterval(countdownInterval);
    countdownInterval = setInterval(() => {
      const now = new Date().getTime();
      const diff = countdownTarget - now;
      if (diff <= 0) {
        clearInterval(countdownInterval);
        document.getElementById("countdown").textContent = "PRESALE ENDED";
        disablePresaleForm();
        return;
      }
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      document.getElementById("countdown").textContent =
        `${String(days).padStart(2, '0')}:${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }, 1000);
  }

  function calculateWaldo() {
    const xrp = parseInt(document.getElementById("xrpAmount").value, 10);
    const baseWaldo = xrp * 100000;
    let bonus = 0;
    if (xrp === 80) bonus = 2000000;
    else if (xrp === 90) bonus = 3000000;
    else if (xrp === 100) bonus = 5000000;
    const totalWaldo = baseWaldo + bonus;
    document.getElementById("waldoAmount").innerText =
      `You will receive ${totalWaldo.toLocaleString()} WaldoCoins.`;
  }

  document.getElementById("confirmPurchaseBtn").addEventListener("click", async () => {
    const txId = document.getElementById("txId").value.trim();
    const email = document.getElementById("userEmail").value.trim();
    const btn = document.getElementById("confirmPurchaseBtn");
    if (!txId) {
      alert("Please enter a transaction ID.");
      return;
    }
    if (presaleEnded) {
      alert("Presale has ended. Cannot confirm purchase.");
      return;
    }
    btn.disabled = true;
    btn.innerText = "Verifying...";
    try {
      const res = await fetch(`${baseURL}/api/presale/verify`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ txId, email })
      });
      const data = await res.json();
      if (data.success) {
        alert(`‚úÖ Purchase Verified! You bought ${data.tokens.toLocaleString()} WALDO`);
        document.getElementById("waldoAmount").innerText = "‚úÖ Waiting for WALDO to arrive in your wallet...";
      } else {
        alert(`‚ùå ${data.error || "Verification failed."}`);
      }
    } catch (err) {
      alert("‚ùå Network error while verifying.");
    }
    btn.disabled = false;
    btn.innerText = "Confirm Purchase";
  });

  async function lookupWallet() {
    const address = document.getElementById("walletSearch").value.trim();
    const resultDiv = document.getElementById("lookupResult");
    if (!address || !address.startsWith("r")) {
      resultDiv.innerHTML = "<p style='color:red;'>Please enter a valid XRP wallet address.</p>";
      return;
    }
    resultDiv.innerHTML = "üîé Searching WALDO ledger...";
    try {
      const response = await fetch(`${baseURL}/api/presale/lookup?wallet=${address}`);
      const data = await response.json();
      if (data && data.amount) {
        resultDiv.innerHTML = `
          <p><strong>Wallet:</strong> ${address}</p>
          <p><strong>Total Contributed:</strong> ${data.amount} XRP</p>
          <p><strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}</p>
          ${data.email ? `<p><strong>Email:</strong> ${data.email}</p>` : ""}
          <p><strong>üéÅ Bonus Tier:</strong> ${data.bonusTier || "N/A"}</p>
        `;
      } else {
        resultDiv.innerHTML = "<p>No presale record found for this wallet.</p>";
      }
    } catch (err) {
      console.error(err);
      resultDiv.innerHTML = "<p style='color:red;'>Error retrieving data. Try again later.</p>";
    }
  }

  async function loadPresaleFeed() {
    try {
      const res = await fetch(`${baseURL}/api/presale/feed`);
      const data = await res.json();
      const feed = document.getElementById("presaleFeed");
      feed.innerHTML = "";
      data.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `üïí ${new Date(item.timestamp).toLocaleTimeString()} ‚Äî Wallet ${item.wallet.slice(0, 4)}...${item.wallet.slice(-4)} bought ${item.tokens.toLocaleString()} WALDO`;
        feed.appendChild(li);
      });
    } catch (err) {
      console.error("Failed to load presale feed", err);
    }
  }

  function updateMeter(sold, max) {
    const percent = (sold / max) * 100;
    document.getElementById("waldoSold").textContent = sold.toLocaleString();
    document.getElementById("progressBar").style.width = percent + "%";
    checkPresaleEnd(sold);
  }

  function checkPresaleEnd(soldAmount) {
    const now = new Date();
    if (now >= endDate || soldAmount >= hardCap) {
      presaleEnded = true;
      disablePresaleForm();
    }
  }

  function disablePresaleForm() {
    document.getElementById("confirmPurchaseBtn").disabled = true;
    document.getElementById("confirmPurchaseBtn").innerText = "Presale Ended";
    document.getElementById("confirmPurchaseBtn").style.background = "#555";
    document.getElementById("confirmPurchaseBtn").style.cursor = "not-allowed";
    ["xrpAmount", "txId", "userEmail"].forEach(id => {
      document.getElementById(id).disabled = true;
    });
    const countdown = document.getElementById("countdown");
    countdown.textContent = "PRESALE CLOSED";
    countdown.style.color = "#aaa";
    countdown.style.borderColor = "#aaa";
    countdown.style.boxShadow = "none";
  }

  document.addEventListener("DOMContentLoaded", () => {
    startCountdownLoop();
    loadPresaleFeed();
    fetch(`${baseURL}/api/presale/total-sold`)
      .then(res => res.json())
      .then(data => updateMeter(data.sold, hardCap));
    setInterval(() => {
      fetch(`${baseURL}/api/presale/total-sold`)
        .then(res => res.json())
        .then(data => updateMeter(data.sold, hardCap));
    }, 60000);
    setInterval(loadPresaleFeed, 60000);
  });
</script>
</body>
</html>