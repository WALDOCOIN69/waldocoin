<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WALDO Staking</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      background: #070a18;
      color: #eafff9;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .center {
      max-width: 840px;
      margin: 20px auto;
      padding: 0 12px;
    }

    .loader {
      margin: 60px auto;
      width: 32px;
      height: 32px;
      border: 3px solid #1a1a1a;
      border-top-color: #25c2a0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .hint {
      text-align: center;
      opacity: .8;
      font-size: 14px;
    }

    a {
      color: #9adbcf;
    }
  </style>
</head>

<body>
  <div class="center">
    <div id="mount">
      <div class="loader" aria-label="loading"></div>
      <p class="hint">Loading WALDO Stakingâ€¦</p>
    </div>
  </div>

  <script>
    (function () {
      const target = document.getElementById('mount');
      // Cache buster to avoid stale copies
      const ver = (window.WALDO_WIDGET_VERSION || Date.now());
      const src = 'waldo-staking-widget.html?v=' + encodeURIComponent(ver);
      fetch(src, { cache: 'no-store' }).then(async (r) => {
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const html = await r.text();
        target.innerHTML = html;
        // Ensure scripts in the injected HTML execute
        const scripts = target.querySelectorAll('script');
        for (const old of scripts) {
          const s = document.createElement('script');
          if (old.src) { s.src = old.src; } else { s.textContent = old.textContent; }
          // Copy attributes
          for (const a of old.attributes) s.setAttribute(a.name, a.value);
          old.replaceWith(s);
        }
        // Fallback: ensure widget opens and toggle works even if inner script didn't bind
        try {
          const stake = document.getElementById('waldoStake');
          if (stake) stake.classList.remove('collapsed');
          const toggle = document.getElementById('stakeToggle');
          if (toggle) {
            toggle.addEventListener('click', () => {
              const root = document.getElementById('waldoStake');
              if (root) root.classList.toggle('collapsed');
            }, { passive: true });
          }
        } catch (_) { }
      }).catch((e) => {
        target.innerHTML = '<p class="hint">Failed to load widget (' + e.message + ').</p>' +
          '<p class="hint">Open the raw widget file: <a href="https://raw.githubusercontent.com/WALDOCOIN69/waldocoin/main/WordPress/widgets/waldo-staking-widget.html" target="_blank" rel="noopener">waldo-staking-widget.html</a></p>';
      });
    })();
  </script>
</body>

</html>