<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>WALDOcoin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
  <style>
    html,
    body {
      font-family: 'Inter', sans-serif;
      background-image: url("https://waldocoin.live/wp-content/uploads/2025/05/1737843965137.jpg") !important;
      background-color: #000 !important;
      background-size: 200px 200px !important;
      background-repeat: repeat !important;
      background-attachment: fixed !important;
      margin: 0;
      padding: 0;
    }

    /* Navigation Header */
    .nav-header {
      background: #1a1a1a;
      border-bottom: 2px solid #25c2a0;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav-logo {
      font-size: 1.5rem;
      font-weight: bold;
      color: #25c2a0;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .nav-link {
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-link:hover {
      background: #25c2a0;
      color: white;
      transform: translateY(-1px);
    }

    .wallet-display {
      background: #333;
      padding: 8px 16px;
      border-radius: 20px;
      font-family: monospace;
      font-size: 0.9rem;
      color: #25c2a0;
    }

    .disconnect-button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .disconnect-button:hover {
      background: #c82333;
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .nav-header {
        flex-direction: column;
        gap: 15px;
        padding: 15px;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .disconnect-button {
        padding: 6px 12px;
        font-size: 0.8rem;
      }

      .nav-logo {
        font-size: 1.2rem;
      }
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 40px 10px;
      box-sizing: border-box;
    }

    iframe {
      display: block;
      margin: 0 auto;
      width: 100%;
      max-width: 100%;
    }

    @media (min-width: 768px) {
      .container {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }
    }

    .card {
      background: #111;
      color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
      animation: fadeInUp 0.8s ease;
      position: relative;
    }

    .big-card {
      grid-column: 1 / -1;
      padding: 30px;
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      .big-card {
        font-size: 1rem;
        padding: 20px;
      }
    }

    .card h1,
    .card h2,
    .card h3 {
      color: white;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }

    th,
    td {
      padding: 10px;
      border-bottom: 1px solid #333;
    }

    thead th {
      background: #222;
      color: #25c2a0;
      font-weight: bold;
    }

    .tooltip-wrapper {
      position: relative;
      display: inline-block;
    }

    .tooltip-icon {
      background: #25c2a0;
      color: black;
      font-size: 14px;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 50%;
      cursor: pointer;
      line-height: 1;
    }

    .tooltip-text {
      visibility: hidden;
      width: 240px;
      background-color: #111;
      color: #25c2a0;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -120px;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 0 10px #25c2a0;
    }

    .tooltip-wrapper:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .disconnect-btn {
      display: block;
      margin: 0 auto 20px;
      background: red;
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }

    .meme-thumb {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .meme-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 0 10px #fb2f2f;
    }

    .flip-card {
      background-color: transparent;
      width: 200px;
      height: 280px;
      perspective: 1000px;
      cursor: pointer;
    }

    .flip-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }

    .flip-card:hover .flip-card-inner {
      transform: rotateY(180deg);
    }

    .flip-card-front,
    .flip-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      box-shadow: 0 0 10px #ff5252;
      background: #111;
      color: white;
    }

    .flip-card-back {
      transform: rotateY(180deg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
      padding: 15px;
    }

    .flip-card img {
      width: 100%;
      height: auto;
      border-radius: 10px;
    }

    .battle-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      margin-top: 10px;
      animation: pulse 1.5s infinite;
    }

    .badge-open {
      background: #25c2a0;
      color: black;
      box-shadow: 0 0 10px #25c2a0;
    }

    .badge-expired {
      background: #ff4136;
      color: white;
      box-shadow: 0 0 10px #ff4136;
    }

    .badge-complete {
      background: #0074D9;
      color: white;
      box-shadow: 0 0 10px #0074D9;
    }

    .badge-waiting {
      background: #FFDC00;
      color: black;
      box-shadow: 0 0 10px #FFDC00;
    }

    #waldoNotification {
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #111;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 0 20px #25c2a0;
      z-index: 9999;
      font-weight: bold;
      text-align: center;
      animation: pulseBanner 2s infinite;
      max-width: 90%;
    }

    @keyframes pulseBanner {
      0% {
        box-shadow: 0 0 10px #25c2a0;
      }

      50% {
        box-shadow: 0 0 20px #25c2a0;
      }

      100% {
        box-shadow: 0 0 10px #25c2a0;
      }
    }

    .dismiss-btn {
      margin-left: 20px;
      background: transparent;
      border: 1px solid #25c2a0;
      color: #25c2a0;
      padding: 4px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .center-text {
      text-align: center;
    }

    .wallet-address {
      text-align: center;
      margin-bottom: 30px;
    }

    .flex-column-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .xp-stats-card {
      background: #111;
      color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
    }

    .nft-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .close-nft-modal {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }

    .waldo-total-earned-display {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
    }

    .waldo-promo-img {
      width: 100%;
      border-radius: 8px;
    }

    .button-style {
      width: 100%;
      max-width: 400px;
      padding: 10px 14px;
      border-radius: 6px;
      background: #25c2a0;
      color: black;
      font-weight: bold;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }

    .input-style {
      width: 100%;
      max-width: 400px;
      padding: 10px 14px;
      border-radius: 6px;
      background: #222;
      color: white;
      border: 1px solid #444;
      font-size: 16px;
    }

    .minted-gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
    }

    .xrpl-link-red {
      color: #ff5252;
      text-decoration: none;
    }

    .xrpl-link-green {
      color: #25c2a0;
      text-decoration: none;
    }

    .twitter-link-status {
      margin-top: 6px;
      color: #25c2a0;
      text-align: center;
    }

    .activity-feed {
      list-style: none;
      padding: 0;
    }

    .leaderboard-list {
      list-style: none;
      padding: 0;
      font-size: 16px;
    }

    .leaderboard-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
    }

    .flex-item {
      flex: 1;
      min-width: 300px;
    }

    .info-text {
      font-size: 14px;
      color: #aaa;
      margin-top: 10px;
    }

    .reward-logic-table {
      grid-column: span 2;
    }

    .margin-top-0 {
      margin-top: 0;
    }

    .margin-top-20 {
      margin-top: 20px;
    }

    .battle-arena {
      text-align: center;
      background-color: #181818;
    }

    .battle-notification {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fb2f2f;
      color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(251, 47, 47, 0.6);
      z-index: 999;
      animation: pulse 2s infinite;
      cursor: pointer;
    }

    .battle-memes-container {
      display: flex;
      justify-content: space-around;
      gap: 30px;
      flex-wrap: wrap;
    }

    .battle-timer {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
    }

    .battle-result {
      font-weight: bold;
      font-size: 16px;
      color: gold;
      margin-top: 10px;
    }

    .centered-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .centered-flex-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .overflow-auto {
      overflow-x: auto;
    }

    .pagination {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 15px;
    }

    .pagination button {
      padding: 5px 10px;
      border: none;
      background: transparent;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    .meme-score {
      font-size: 60px;
      font-weight: bold;
      color: #25c2a0;
      transition: all 0.5s ease;
    }

    .reward-logic-table {
      grid-column: 1 / -1;
      max-width: 800px;
      margin: 0 auto;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
    }

    .nft-modal-image {
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      box-shadow: 0 0 20px #fb2f2f;
    }



    /* Enhanced Stats Dashboard Styles */
    .level-card {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border: 2px solid #fb2f2f;
    }

    .level-display {
      text-align: center;
      padding: 20px 0;
    }

    .level-number {
      font-size: 3rem;
      font-weight: bold;
      color: #fb2f2f;
      text-shadow: 0 0 10px #fb2f2f;
    }

    .level-title {
      font-size: 1.2rem;
      color: #ffcc00;
      margin: 10px 0;
      font-weight: bold;
    }

    .xp-display {
      font-size: 1.1rem;
      margin: 15px 0;
    }

    .level-progress-bar {
      width: 100%;
      height: 20px;
      border-radius: 10px;
      background: #333;
      border: none;
      overflow: hidden;
    }

    .level-progress-bar::-webkit-progress-bar {
      background: #333;
      border-radius: 10px;
    }

    .level-progress-bar::-webkit-progress-value {
      background: linear-gradient(90deg, #fb2f2f 0%, #ffcc00 100%);
      border-radius: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-item {
      text-align: center;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 8px;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      border-color: #fb2f2f;
      transform: translateY(-2px);
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #fb2f2f;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #ccc;
    }

    .xp-breakdown {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 15px;
    }

    .xp-source {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: #1a1a1a;
      border-radius: 8px;
      border-left: 4px solid #fb2f2f;
    }

    .xp-icon {
      font-size: 1.2rem;
      margin-right: 10px;
    }

    .xp-label {
      flex: 1;
      font-weight: 500;
    }

    .xp-value {
      font-weight: bold;
      color: #ffcc00;
    }

    .balance-breakdown {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: #ccc;
    }

    /* Enhanced Battle Arena Styles */
    .battle-stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 8px;
    }

    .battle-stat {
      text-align: center;
      padding: 15px;
      background: #222;
      border-radius: 8px;
      border: 1px solid #333;
    }

    .battle-stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #fb2f2f;
      margin-bottom: 5px;
    }

    .battle-stat-label {
      font-size: 0.9rem;
      color: #ccc;
    }

    .battle-tabs {
      display: flex;
      gap: 5px;
      margin: 20px 0;
      border-bottom: 2px solid #333;
    }

    .battle-tab {
      padding: 12px 20px;
      background: #222;
      border: none;
      color: #ccc;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s ease;
    }

    .battle-tab:hover {
      background: #333;
      color: white;
    }

    .battle-tab.active {
      background: #fb2f2f;
      color: white;
      border-bottom: 2px solid #fb2f2f;
    }

    .battle-tab-content {
      display: none;
      padding: 20px 0;
      min-height: 300px;
    }

    .battle-tab-content.active {
      display: block;
    }

    .create-battle-form {
      max-width: 600px;
      margin: 0 auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #fff;
    }

    .battle-type-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #222;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .radio-option:hover {
      background: #333;
    }

    .radio-option input[type="radio"] {
      margin: 0;
    }

    .battle-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .button-style.primary {
      background: #fb2f2f;
      border: 2px solid #fb2f2f;
    }

    .button-style.secondary {
      background: transparent;
      border: 2px solid #fb2f2f;
      color: #fb2f2f;
    }

    .button-style.secondary:hover {
      background: #fb2f2f;
      color: white;
    }

    .battle-leaderboard {
      margin-top: 30px;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 8px;
    }

    .battle-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      margin: 10px 0;
      background: #222;
      border-radius: 8px;
      border-left: 4px solid #fb2f2f;
    }

    .battle-memes {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .battle-meme {
      text-align: center;
    }

    .battle-meme img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 5px;
    }

    .battle-votes {
      text-align: center;
      min-width: 100px;
    }

    .vote-count {
      font-size: 1.5rem;
      font-weight: bold;
      color: #fb2f2f;
    }

    .vote-button {
      padding: 8px 16px;
      background: #fb2f2f;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }

    .vote-button:hover {
      background: #d42626;
    }

    .vote-button:disabled {
      background: #666;
      cursor: not-allowed;
    }

    /* NFT Collection Styles */
    .nft-collection {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border: 2px solid #25c2a0;
    }

    .nft-user-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 8px;
    }

    .nft-stat {
      text-align: center;
      padding: 15px;
      background: #222;
      border-radius: 8px;
      border: 1px solid #333;
    }

    .nft-stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #25c2a0;
      margin-bottom: 5px;
    }

    .nft-stat-label {
      font-size: 0.9rem;
      color: #ccc;
    }

    .nft-quick-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .action-button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .action-button.primary {
      background: #25c2a0;
      color: white;
    }

    .action-button.primary:hover {
      background: #1ea085;
      transform: translateY(-2px);
    }

    .action-button.secondary {
      background: transparent;
      border: 2px solid #25c2a0;
      color: #25c2a0;
    }

    .action-button.secondary:hover {
      background: #25c2a0;
      color: white;
    }

    .action-button.mint {
      background: #ffcc00;
      color: #000;
    }

    .action-button.mint:hover {
      background: #e6b800;
      transform: translateY(-2px);
    }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .nft-card {
      background: #222;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .nft-card:hover {
      border-color: #25c2a0;
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(37, 194, 160, 0.2);
    }

    .nft-image {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .nft-content {
      padding: 15px;
    }

    .nft-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: white;
      font-size: 0.9rem;
      line-height: 1.3;
    }

    .nft-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #ccc;
      margin-bottom: 10px;
    }

    .meme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .meme-card {
      background: #222;
      border-radius: 12px;
      padding: 15px;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .meme-card:hover {
      border-color: #ffcc00;
      transform: translateY(-2px);
    }

    .meme-xp {
      color: #ffcc00;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .mint-button {
      width: 100%;
      padding: 10px;
      background: #ffcc00;
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s ease;
    }

    .mint-button:hover {
      background: #e6b800;
    }

    .my-nfts-section,
    .eligible-memes-section {
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #333;
    }

    /* DAO Awareness Section */
    .dao-awareness {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      border: 2px solid #ffcc00;
    }

    .dao-subtitle {
      color: #ccc;
      font-size: 1rem;
      margin-bottom: 25px;
      text-align: center;
    }

    .proposals-preview {
      margin-bottom: 25px;
    }

    .proposals-preview h3 {
      color: #ffcc00;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .proposals-list {
      max-height: 200px;
      overflow-y: auto;
    }

    .proposal-preview-item {
      background: #222;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .proposal-preview-item:hover {
      border-color: #ffcc00;
      transform: translateY(-1px);
    }

    .proposal-preview-title {
      font-weight: bold;
      color: white;
      margin-bottom: 8px;
      font-size: 1rem;
    }

    .proposal-preview-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      color: #ccc;
    }

    .proposal-status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .status-active {
      background: #25c2a0;
      color: white;
    }

    .dao-action {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid #333;
    }

    .dao-vote-button {
      display: inline-block;
      background: #ffcc00;
      color: #000;
      padding: 15px 30px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      margin-bottom: 10px;
    }

    .dao-vote-button:hover {
      background: #e6b800;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
    }

    .dao-stats-mini {
      color: #ccc;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    .no-proposals {
      text-align: center;
      padding: 30px;
      color: #666;
    }

    .no-proposals h4 {
      margin-bottom: 10px;
      color: #888;
    }

    @media (min-width: 768px) {
      .container {
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      }
    }
  </style>
</head>

<body>
  <!-- Navigation Header -->
  <div class="nav-header">
    <div class="nav-logo">💰 WALDOCOIN Dashboard</div>
    <div class="nav-links">
      <a href="dao.html" class="nav-link">🗳️ DAO</a>
      <a href="marketplace.html" class="nav-link">🏪 Marketplace</a>
      <div class="wallet-display" id="navWalletDisplay">Not Connected</div>
      <button class="disconnect-button" onclick="disconnectWallet()" id="disconnectBtn" style="display: none;">
        🔌 Disconnect
      </button>
    </div>
  </div>

  <div id="waldoNotification">
    <span id="waldoMessage"></span>
    <button type="button" onclick="dismissWaldoNotification()" class="dismiss-btn">Dismiss</button>
  </div>
  <div class="container">
    <!-- Welcome Card -->
    <div class="card big-card">
      <h2>👋 Welcome to the WALDOcoin Organization</h2>
      <button type="button" onclick="logoutWallet()" class="disconnect-btn">🔌 Disconnect</button>
      <p id="walletAddress" class="wallet-address">Wallet: Loading...</p>
      <h3 class="center-text">🔗 Link Twitter Account</h3>
      <div class="flex-column-center">
        <input id="twitterHandle" type="text" placeholder="@yourhandle" class="input-style">
        <button type="button" onclick="linkTwitter()" class="button-style">Link Twitter</button>
        <p id="twitterLinkStatus" class="twitter-link-status"></p>
      </div>
    </div>

    <!-- Member Level Card -->
    <div class="card">
      <h2>🎮 Member Level</h2>
      <img alt="Level Icon" class="level-icon" id="userLevelIcon"
        src="https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg">
      <progress id="levelProgress" max="100" class="progress-bar" value="0"></progress>
    </div>
    <!-- Meme XP Trends Card -->
    <div class="card">
      <h2>📊 Meme XP Trends</h2>
      <canvas height="200" id="xpChart"></canvas>
    </div>
    <!-- Social Stats Card -->
    <div class="card">
      <h2>📱 Social Stats</h2>
      <p><strong>🔥 Top Meme:</strong> <span id="socialHandle">Loading...</span></p>
      <p><strong>👥 Followers:</strong> <span id="socialFollowers">—</span></p>
      <p><strong>🔥 Total Likes:</strong> <span id="totalLikes">Loading...</span></p>
      <p><strong>🏆 Top Meme Likes:</strong> <span id="topMemeLikes">Loading...</span></p>
      <p><strong>🖼️ Top Meme Preview:</strong></p>
      <img id="topMemeImage" src="https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg" alt="Top Meme"
        class="meme-thumb">
      <p><a id="topMemeLink" href="#" target="_blank" class="xrpl-link-green">🔗 View Meme</a></p>
    </div>

    <!-- Enhanced Level & Progress Card -->
    <div class="card level-card">
      <h2>⭐ Level & Progress</h2>
      <div class="level-display">
        <div class="level-number" id="waldoLevel">Loading...</div>
        <div class="level-title" id="waldoTitle">Loading...</div>
        <div class="xp-display">
          <span id="waldoXP">0</span> XP
          <small>(<span id="xpToNextLevel">—</span> to next level)</small>
        </div>
        <progress id="levelProgressEnhanced" max="100" class="level-progress-bar" value="0"></progress>
      </div>
    </div>

    <!-- Activity Stats Grid Card -->
    <div class="card">
      <h2>📊 Activity Stats</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" id="waldoLikes">0</div>
          <div class="stat-label">❤️ Likes</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="waldoRetweets">0</div>
          <div class="stat-label">🔁 Retweets</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="waldoMemes">0</div>
          <div class="stat-label">🎭 Memes</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="waldoBattles">0</div>
          <div class="stat-label">⚔️ Battles</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="waldoReferrals">0</div>
          <div class="stat-label">📣 Referrals</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="waldoNFTs">0</div>
          <div class="stat-label">🖼️ NFTs</div>
        </div>
      </div>
    </div>

    <!-- XP Breakdown Card -->
    <div class="card">
      <h2>🎯 XP Breakdown</h2>
      <div class="xp-breakdown">
        <div class="xp-source">
          <span class="xp-icon">❤️</span>
          <span class="xp-label">Likes</span>
          <span class="xp-value" id="xpFromLikes">0 XP</span>
        </div>
        <div class="xp-source">
          <span class="xp-icon">🔁</span>
          <span class="xp-label">Retweets</span>
          <span class="xp-value" id="xpFromRetweets">0 XP</span>
        </div>
        <div class="xp-source">
          <span class="xp-icon">⚔️</span>
          <span class="xp-label">Battle Wins</span>
          <span class="xp-value" id="xpFromBattles">0 XP</span>
        </div>
        <div class="xp-source">
          <span class="xp-icon">📣</span>
          <span class="xp-label">Referrals</span>
          <span class="xp-value" id="xpFromReferrals">0 XP</span>
        </div>
        <div class="xp-source">
          <span class="xp-icon">🗳️</span>
          <span class="xp-label">Voting</span>
          <span class="xp-value" id="xpFromVoting">0 XP</span>
        </div>
        <div class="xp-source">
          <span class="xp-icon">⏳</span>
          <span class="xp-label">Staking Bonus</span>
          <span class="xp-value" id="xpFromStaking">0 XP</span>
        </div>
      </div>
    </div>
    <!-- Total WALDO Earned Card -->
    <div class="card">
      <h2>💰 Total WALDO Earned</h2>
      <p id="waldoTotalEarnedDisplay" class="waldo-total-earned-display">Loading...</p>
    </div>
    <!-- Media card -->
    <div class="card">
      <img alt="WALDO Promo" src="https://waldocoin2.local/wp-content/uploads/2025/03/1737843965524.jpg"
        class="waldo-promo-img">
      <h1>Use #WaldoMeme on Tweets for Rewards.</h1>
    </div>
    <!-- Meme XP Score Card -->
    <div class="card full-width-card center-text">
      <h2>🎯 Your Meme XP Score</h2>
      <p id="memeScoreDisplay" class="meme-score">0</p>
    </div>
    <!-- WALDO Conversion Rate Card -->
    <div class="card">
      <h2>💸 WALDO Conversion Rate</h2>
      <p class="waldoConversionRate text-center">Loading...</p>
      <h3 class="center-text">My WALDO Earnings</h3>
      <p id="walletConversions" class="text-center">Loading...</p>
    </div>
    <!-- Referral Program Card -->
    <div class="card">
      <h2>🤝 Referral Program</h2>
      <p class="center-text">Share your referral link to earn rewards when friends use #WaldoMeme.</p>
      <div class="flex-column-center">
        <input id="referralLink" readonly type="text" class="input-style">
        <button type="button" onclick="copyReferral()" class="button-style">Copy Referral Link</button>
        <p id="copyStatus" class="twitter-link-status"></p>
        <p class="centered-text">👥 Referrals: <strong id="refCount">0</strong></p>
      </div>
    </div>
    <!-- Recent Activity Card -->
    <div class="card">
      <h2>📰 Recent Activity</h2>
      <ul id="activityFeed" class="activity-feed"></ul>
    </div>
    <!-- WALDO/USD Trend Card -->
    <div class="card">
      <h2>📈 WALDO/USD Trend (7 Days)</h2>
      <canvas height="200" id="waldoPriceChart"></canvas>
    </div>
    <!-- Media card -->
    <div class="card">
      <img alt="WALDO Promo" src="https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg"
        class="waldo-promo-img">
      <h1>Use #WaldoMeme on Tweets for Rewards.</h1>
    </div>
    <!-- Reward Tiers Card -->
    <div class="card reward-logic-table">
      <h2>💎 Reward Tiers</h2>
      <div class="overflow-auto">
        <table>
          <thead>
            <tr>
              <th scope="col">Tier</th>
              <th scope="col">Likes</th>
              <th scope="col">Retweets</th>
              <th scope="col">Base</th>
              <th scope="col">Instant Payout</th>
              <th scope="col">Stake Payout</th>
              <th scope="col">Max No-Stake (x40)</th>
              <th scope="col">Max Stake (x40)</th>
            </tr>
          </thead>
          <tbody id="rewardTierBody"></tbody>
        </table>
      </div>
    </div>
    <!-- Meme Table with Pagination, XP, Claim/Stake/Mint -->
    <div class="card big-card">
      <div class="centered-flex-container">
        <h2 class="margin-top-0">📸 My Memes</h2>
        <div class="tooltip-wrapper">
          <span class="tooltip-icon">i</span>
          <span class="tooltip-text">Each meme must reach 60 XP to be eligible for minting as an NFT.</span>
        </div>
      </div>
      <div class="overflow-auto">
        <table>
          <thead>
            <tr>
              <th scope="col">Thumbnail</th>
              <th scope="col">Retweets</th>
              <th scope="col">Likes</th>
              <th scope="col">XP</th>
              <th scope="col">Tier</th>
              <th scope="col">Claim</th>
              <th scope="col">Stake</th>
              <th scope="col">Mint</th>
            </tr>
          </thead>
          <tbody id="memeTableBody"></tbody>
        </table>
        <div class="pagination" id="pagination"></div>
      </div>
    </div>
    <!-- Enhanced Battle Arena -->
    <div id="battleNotification" class="battle-notification">
      ⚔️ Battle has started! Join now and vote for your favorite meme!
    </div>
    <div class="card big-card battle-arena">
      <h2>🔥 Enhanced Battle Arena</h2>

      <!-- Battle Stats Overview -->
      <div class="battle-stats-overview">
        <div class="battle-stat">
          <div class="battle-stat-number" id="totalBattles">0</div>
          <div class="battle-stat-label">Total Battles</div>
        </div>
        <div class="battle-stat">
          <div class="battle-stat-number" id="activeBattles">0</div>
          <div class="battle-stat-label">Active Now</div>
        </div>
        <div class="battle-stat">
          <div class="battle-stat-number" id="totalVotes">0</div>
          <div class="battle-stat-label">Total Votes</div>
        </div>
        <div class="battle-stat">
          <div class="battle-stat-number" id="totalPrizePool">0</div>
          <div class="battle-stat-label">WALDO Distributed</div>
        </div>
      </div>

      <!-- Battle Tabs -->
      <div class="battle-tabs">
        <button class="battle-tab active" onclick="showBattleTab('active')">🔥 Active Battles</button>
        <button class="battle-tab" onclick="showBattleTab('pending')">⏳ Pending</button>
        <button class="battle-tab" onclick="showBattleTab('completed')">🏆 Completed</button>
        <button class="battle-tab" onclick="showBattleTab('create')">⚔️ Create Battle</button>
      </div>

      <!-- Active Battles Tab -->
      <div id="activeBattlesTab" class="battle-tab-content active">
        <div id="activeBattlesList">Loading active battles...</div>
      </div>

      <!-- Pending Battles Tab -->
      <div id="pendingBattlesTab" class="battle-tab-content">
        <div id="pendingBattlesList">Loading pending battles...</div>
      </div>

      <!-- Completed Battles Tab -->
      <div id="completedBattlesTab" class="battle-tab-content">
        <div id="completedBattlesList">Loading completed battles...</div>
      </div>

      <!-- Create Battle Tab -->
      <div id="createBattleTab" class="battle-tab-content">
        <div class="create-battle-form">
          <h3>🚀 Start a New Battle</h3>
          <div class="form-group">
            <label>Your Meme Tweet URL:</label>
            <input id="memeTweetId" type="text" class="input-style" placeholder="https://x.com/user/status/1234567890"
              onblur="extractTweetId(this.value)">
          </div>
          <div class="form-group">
            <label>Challenge Type:</label>
            <div class="battle-type-options">
              <label class="radio-option">
                <input type="radio" name="battleType" value="open" checked>
                <span>Open Challenge (Anyone can accept)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="battleType" value="specific">
                <span>Specific Challenge</span>
              </label>
            </div>
          </div>
          <div class="form-group" id="specificChallengeGroup" style="display: none;">
            <label>Challenge Twitter Handle:</label>
            <input id="challengeHandle" type="text" class="input-style" placeholder="@username">
          </div>
          <div class="battle-actions">
            <button type="button" onclick="startNewBattle()" class="button-style primary">
              🧠 Start Battle (150 WALDO)
            </button>
            <button type="button" onclick="startOpenBattle()" class="button-style secondary">
              🌍 Open Challenge (100 WALDO)
            </button>
          </div>
        </div>
      </div>

      <!-- Battle Leaderboard -->
      <div class="battle-leaderboard">
        <h3>🏆 Battle Champions</h3>
        <div id="battleLeaderboard">Loading leaderboard...</div>
      </div>
    </div>

    <!-- My NFT Collection -->
    <div class="card big-card nft-collection">
      <h2>🖼️ My NFT Collection</h2>

      <!-- NFT Stats -->
      <div class="nft-user-stats">
        <div class="nft-stat">
          <div class="nft-stat-number" id="userNFTCount">0</div>
          <div class="nft-stat-label">NFTs Owned</div>
        </div>
        <div class="nft-stat">
          <div class="nft-stat-number" id="userMintedCount">0</div>
          <div class="nft-stat-label">Minted by Me</div>
        </div>
        <div class="nft-stat">
          <div class="nft-stat-number" id="eligibleToMint">0</div>
          <div class="nft-stat-label">Ready to Mint</div>
        </div>
        <div class="nft-stat">
          <div class="nft-stat-number" id="totalNFTValue">0</div>
          <div class="nft-stat-label">Collection Value</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="nft-quick-actions">
        <a href="marketplace.html" class="action-button primary">
          🏪 Browse Marketplace
        </a>
        <a href="my-nfts.html" class="action-button secondary">
          📋 Manage My NFTs
        </a>
        <button class="action-button mint" onclick="showMintableNFTs()">
          ⚡ Mint New NFT
        </button>
      </div>

      <!-- My NFTs Grid -->
      <div class="my-nfts-section">
        <h3>🖼️ My Minted NFTs</h3>
        <div id="myNFTsGrid" class="nft-grid">Loading your NFTs...</div>
      </div>

      <!-- Eligible to Mint -->
      <div class="eligible-memes-section" id="eligibleMemesSection" style="display: none;">
        <h3>⚡ Ready to Mint (60+ XP)</h3>
        <div id="eligibleMemesGrid" class="meme-grid">Loading eligible memes...</div>
      </div>
    </div>

    <!-- DAO Governance Awareness -->
    <div class="card big-card dao-awareness">
      <h2>🗳️ WALDOcoin DAO Governance</h2>
      <p class="dao-subtitle">Participate in decentralized governance and community voting</p>

      <!-- Active Proposals Preview -->
      <div class="proposals-preview">
        <h3>📋 Active Proposals</h3>
        <div id="proposalsPreview" class="proposals-list">
          Loading active proposals...
        </div>
      </div>

      <!-- Action Button -->
      <div class="dao-action">
        <a href="dao.html" class="dao-vote-button">
          🗳️ View All Proposals & Vote
        </a>
        <div class="dao-stats-mini">
          <span id="activeProposalsCount">0</span> active proposals
        </div>
      </div>
    </div>
  </div>
  <!-- NFT Modal -->
  <div id="nftModal" class="nft-modal">
    <span onclick="closeNFTModal()" class="close-nft-modal">&times;</span>
    <img id="nftModalImg" src="https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg" alt="NFT Preview"
      class="nft-modal-image">
  </div>


  <script>
    function getWallet() {
      return localStorage.getItem("xummWallet") || "rnWfL48YCknW6PYewFLKfMKUymHCfj3aww";
    }

    function updateNavWallet() {
      const wallet = getWallet();
      const navDisplay = document.getElementById('navWalletDisplay');
      const disconnectBtn = document.getElementById('disconnectBtn');

      if (wallet && navDisplay) {
        navDisplay.textContent = wallet.substring(0, 8) + '...' + wallet.substring(wallet.length - 6);
        if (disconnectBtn) disconnectBtn.style.display = 'block';
      } else {
        navDisplay.textContent = 'Not Connected';
        if (disconnectBtn) disconnectBtn.style.display = 'none';
      }
    }

    function disconnectWallet() {
      // Clear wallet from localStorage
      localStorage.removeItem('xummWallet');
      localStorage.removeItem('connectedWallet');

      // Show notification
      showWaldoNotification('🔌 Wallet disconnected successfully');

      // Update UI
      updateNavWallet();

      // Optionally reload page to reset all data
      setTimeout(() => {
        window.location.reload();
      }, 1500);
    }
    const baseURL = "https://waldocoin-backend-api.onrender.com";
    const rewardTiers = [
      { tier: 1, likes: 25, retweets: 0, base: 1 },
      { tier: 2, likes: 50, retweets: 5, base: 2 },
      { tier: 3, likes: 100, retweets: 10, base: 5 },
      { tier: 4, likes: 500, retweets: 50, base: 25 },
      { tier: 5, likes: 1000, retweets: 100, base: 50 }
    ];
    function logoutWallet() {
      localStorage.removeItem("xummWallet");
      location.href = "https://waldocoin.live/";
    }


    function showWaldoNotification(message) {
      const banner = document.getElementById("waldoNotification");
      document.getElementById("waldoMessage").textContent = message;
      banner.style.display = "block";
      setTimeout(() => {
        banner.style.display = "none";
      }, 5000);
    }

    function dismissWaldoNotification() {
      document.getElementById("waldoNotification").style.display = "none";
    }

    function generateRewardTable() {
      const table = document.getElementById("rewardTierBody");
      if (!table || !Array.isArray(rewardTiers)) return;
      table.innerHTML = "";
      rewardTiers.forEach(t => {
        const row = document.createElement("tr");
        row.innerHTML = `
      <td>Tier ${t.tier}</td>
      <td>${t.likes}+</td>
      <td>${t.retweets}+</td>
      <td>${t.base.toFixed(2)} WALDO</td>
      <td>${(t.base * 0.9).toFixed(2)} WALDO</td>
      <td>${(t.base * 1.15 * 0.95).toFixed(2)} WALDO</td>
      <td>${(t.base * 0.9 * 40).toFixed(2)}</td>
      <td>${(t.base * 1.15 * 0.95 * 40).toFixed(2)}</td>`;
        table.appendChild(row);
      });
    }


    function copyReferral() {
      const input = document.getElementById("referralLink");
      navigator.clipboard.writeText(input.value).then(() => {
        document.getElementById("copyStatus").textContent = "✅ Copied!";
        setTimeout(() => document.getElementById("copyStatus").textContent = "", 2000);
      }).catch(() => {
        document.getElementById("copyStatus").textContent = "❌ Copy failed.";
      });
    }

    function calculateXPToNextLevel(xp) {
      const levels = [0, 250, 850, 1750, 3000];
      for (let i = 0; i < levels.length; i++) {
        if (xp < levels[i]) return levels[i] - xp;
      }
      return 0;
    }

    function renderMemeTable(data) {
      const pageSize = 5;
      let currentPage = 1;
      const totalPages = Math.ceil(data.length / pageSize);

      function drawPage() {
        const start = (currentPage - 1) * pageSize;
        const rows = data.slice(start, start + pageSize).map(m => `
        <tr>
          <td><a href="${m.url}" target="_blank"><img src="${m.image_url}" class="meme-thumb"></a></td>
          <td>${m.retweets}</td>
          <td>${m.likes}</td>
          <td>${m.xp}</td>
          <td>${m.tier ? `Tier ${m.tier}` : '-'}</td>
          <td>${m.tier ? `<button onclick="claimWaldo(${m.tier}, false)">💰 Claim</button>` : '<span style="color:gray">—</span>'}</td>
          <td>${m.tier ? `<button onclick="claimWaldo(${m.tier}, true)">📈 Stake</button>` : '<span style="color:gray">—</span>'}</td>
          <td>${m.xp >= 60 ? `<button onclick="mintMeme('${m.tweet_id}', '${m.image_url}', ${m.likes}, ${m.retweets})">Mint</button>` : '<span style="color:gray">—</span>'}</td>
        </tr>`).join("");
        document.getElementById("memeTableBody").innerHTML = rows;

        const pagination = document.getElementById("pagination");
        pagination.innerHTML = "";
        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.style.background = i === currentPage ? "#fb2f2f" : "transparent";
          btn.onclick = () => { currentPage = i; drawPage(); };
          pagination.appendChild(btn);
        }
      }

      drawPage();
    }

    async function mintMeme(tweetId, imageUrl, likes, retweets) {
      try {
        const feeRes = await fetch(`${baseURL}/api/mint`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ wallet: getWallet(), tweet_id: tweetId, image_url: imageUrl, likes, retweets })

        });
        const feeData = await feeRes.json();
        if (feeData.success) {
          showWaldoNotification("💰 Sign WALDO fee in XUMM...");
          window.open(feeData.sign_url, "_blank");
        }

        setTimeout(async () => {
          const confirmRes = await fetch(`${baseURL}/api/mint/confirm`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ wallet: getWallet(), tweet_id: tweetId, image_url: imageUrl, likes, retweets })
          });
          const confirmData = await confirmRes.json();
          if (confirmData.success) {
            showWaldoNotification("🧬 Mint your NFT in XUMM!");
            window.open(confirmData.sign_url, "_blank");
          } else {
            showWaldoNotification(`❌ Mint failed: ${confirmData.error}`);
          }
        }, 5000);
      } catch (err) {
        console.error("Mint error:", err);
        showWaldoNotification("❌ Mint process failed.");
      }
    }

    function showNFTModal(imageUrl) {
      const modal = document.getElementById("nftModal");
      const img = document.getElementById("nftModalImg");
      img.src = imageUrl;
      img.onerror = () => img.src = '/placeholder.jpg';
      modal.style.display = "flex";
    }

    function closeNFTModal() {
      document.getElementById("nftModal").style.display = "none";
    }

    async function refreshXPStats() {
      const res = await fetch(`${baseURL}/api/userStats?wallet=${getWallet()}`);
      const data = await res.json();

      // Update basic stats
      document.getElementById("waldoXP").textContent = data.xp;
      document.getElementById("xpToNextLevel").textContent = `${calculateXPToNextLevel(data.xp)} XP`;
      document.getElementById("waldoLevel").textContent = `Level ${data.level}`;
      document.getElementById("waldoTitle").textContent = data.title;

      // Update activity stats
      document.getElementById("waldoLikes").textContent = data.likes || 0;
      document.getElementById("waldoRetweets").textContent = data.retweets || 0;
      document.getElementById("waldoMemes").textContent = data.memes || 0;
      document.getElementById("waldoBattles").textContent = data.battles || 0;
      document.getElementById("waldoReferrals").textContent = Array.isArray(data.referrals) ? data.referrals.length : 0;

      // Update XP breakdown if available
      if (data.xpBreakdown) {
        document.getElementById("xpFromLikes").textContent = `${data.xpBreakdown.likes || 0} XP`;
        document.getElementById("xpFromRetweets").textContent = `${data.xpBreakdown.retweets || 0} XP`;
        document.getElementById("xpFromBattles").textContent = `${data.xpBreakdown.battles || 0} XP`;
        document.getElementById("xpFromReferrals").textContent = `${data.xpBreakdown.referrals || 0} XP`;
        document.getElementById("xpFromVoting").textContent = `${data.xpBreakdown.voting || 0} XP`;
        document.getElementById("xpFromStaking").textContent = `${data.xpBreakdown.stakingBonus || 0} XP`;
      }

      // Update progress bars
      const progress = Math.min(100, (data.xp % 250));
      document.getElementById("levelProgress").value = progress;
      document.getElementById("levelProgressEnhanced").value = progress;

      // Update NFT count
      try {
        const nftRes = await fetch(`${baseURL}/api/tweets?wallet=${getWallet()}`);
        const tweets = await nftRes.json();
        const nftCount = tweets.filter(t => t.wallet === getWallet() && t.nft_minted).length;
        document.getElementById("waldoNFTs").textContent = nftCount;
      } catch (e) {
        document.getElementById("waldoNFTs").textContent = "0";
      }
    }

    async function loadWaldoChart() {
      try {
        const res = await fetch("https://api.sologenic.org/api/v1/token/WALDO");
        const data = await res.json();
        const history = data?.token?.marketData?.history?.slice(-7);

        if (!history || history.length === 0) {
          console.warn("No WALDO price history available");
          return;
        }

        const prices = history.map(p => parseFloat(p.close));
        const dates = history.map(p => new Date(p.time).toLocaleDateString());

        new Chart(document.getElementById("waldoPriceChart"), {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'WALDO/USD (Sologenic)',
              data: prices,
              borderColor: '#25c2a0',
              backgroundColor: 'rgba(37, 194, 160, 0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { labels: { color: 'white' } } },
            scales: {
              x: { ticks: { color: 'white' } },
              y: { ticks: { color: 'white' } }
            }
          }
        });
      } catch (error) {
        console.error("Error loading WALDO price chart:", error);
      }
    }

    document.getElementById("referralLink").value = `https://waldocoin2.local/?ref=${getWallet()}`; generateRewardTable();

    try {
      // Fetch stats from backend
      const res = await fetch(`${baseURL}/api/userStats?wallet=${getWallet()}`);
      const data = await res.json();

      // Update DOM with real data
      document.getElementById("waldoXP").textContent = data.xp;
      document.getElementById("waldoLevel").textContent = `Level ${data.level}`;
      document.getElementById("waldoTitle").textContent = data.title;
      document.getElementById("waldoLikes").textContent = data.likes;
      document.getElementById("waldoRetweets").textContent = data.retweets;
      document.getElementById("waldoMemes").textContent = data.memes;
      document.getElementById("waldoBattles").textContent = data.battles;
      document.getElementById("waldoReferrals").textContent = data.referrals.length;

      // XP progress bar logic
      const progress = Math.min(100, (data.xp % 250));
      document.getElementById("levelProgress").value = progress;
    } catch (err) {
      console.error("🚨 Failed to fetch user stats:", err);
      showWaldoNotification("❌ Failed to load dashboard stats.");
    }

    try {
      const tweetsRes = await fetch(`${baseURL}/api/tweets?wallet=${getWallet()}`);
      const tweets = (await tweetsRes.json()).filter(t => t.wallet === wallet);

      const totalLikes = tweets.reduce((sum, t) => sum + t.likes, 0);
      const topLikes = Math.max(...tweets.map(t => t.likes), 0);
      const totalEarned = tweets.reduce((sum, t) => sum + (t.waldo_amount || 0), 0);

      const tweetData = tweets.map(t => {
        const xp = Math.floor(t.likes / 10) + Math.floor(t.retweets / 15);
        const tier = rewardTiers.slice().reverse().find(rt => t.likes >= rt.likes && t.retweets >= rt.retweets)?.tier || 0;
        return { ...t, xp, tier, url: `https://twitter.com/i/web/status/${t.tweet_id}` };
      });

      renderMemeTable(tweetData);
      document.getElementById("totalLikes").textContent = totalLikes;
      document.getElementById("topMemeLikes").textContent = `${topLikes} likes`;
      document.getElementById("waldoTotalEarnedDisplay").textContent = `${totalEarned.toFixed(2)} WALDO`;
      document.getElementById("activityFeed").innerHTML = tweetData.slice(0, 5).map(t => `<li>Posted meme with ${t.likes} likes, earned ${t.waldo_amount || 0} WALDO</li>`).join("");

      const xpSeries = tweetData.map(t => t.xp);
      const labels = tweetData.map((t, i) => `Meme ${i + 1}`);
      new Chart(document.getElementById("xpChart"), {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: 'XP Gained',
            data: xpSeries,
            borderColor: '#fb2f2f',
            backgroundColor: 'rgba(251,47,47,0.2)',
            fill: true,
            tension: 0.3,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: 'white' } } },
          scales: {
            x: { ticks: { color: 'white' } },
            y: { ticks: { color: 'white' } }
          }
        }
      });
      await refreshXPStats()
      loadWaldoChart();
      setInterval(refreshXPStats, 60000);
    } catch (err) {
      console.error("❌ Dashboard load failed:", err);
      showWaldoNotification("❌ Could not load dashboard. Check console.");
    }
  </script>
  <script>
    function sendHeightToParent() {
      const height = document.body.scrollHeight;
      parent.postMessage({ height }, '*');
    }
    window.addEventListener('load', sendHeightToParent);
    window.addEventListener('resize', sendHeightToParent);
    setTimeout(sendHeightToParent, 1000);
  </script>
  <script>
    // NFT Collection Functions
    async function loadNFTStats() {
      try {
        const wallet = getWallet();
        if (!wallet) return;

        // Get user's tweets to check for NFTs
        const tweetsRes = await fetch(`${baseURL}/api/tweets?wallet=${wallet}`);
        const tweets = await tweetsRes.json();
        const userTweets = tweets.filter(t => t.wallet === wallet);

        // Count minted NFTs
        const mintedNFTs = userTweets.filter(t => t.nft_minted);
        const eligibleMemes = userTweets.filter(t => {
          const xp = Math.floor(t.likes / 10) + Math.floor(t.retweets / 15);
          return xp >= 60 && !t.nft_minted;
        });

        // Update stats
        document.getElementById("userNFTCount").textContent = mintedNFTs.length;
        document.getElementById("userMintedCount").textContent = mintedNFTs.length;
        document.getElementById("eligibleToMint").textContent = eligibleMemes.length;

        // Calculate collection value (placeholder)
        const totalValue = mintedNFTs.length * 100; // Estimate 100 WALDO per NFT
        document.getElementById("totalNFTValue").textContent = `${totalValue.toLocaleString()} WALDO`;

        // Load NFT grid
        loadMyNFTs(mintedNFTs);
        loadEligibleMemes(eligibleMemes);

      } catch (error) {
        console.error("❌ Error loading NFT stats:", error);
      }
    }

    function loadMyNFTs(nfts) {
      const container = document.getElementById("myNFTsGrid");

      if (nfts.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ccc;">No NFTs minted yet. Create some memes with 60+ XP to mint!</div>';
        return;
      }

      container.innerHTML = nfts.map(nft => {
        const xp = Math.floor(nft.likes / 10) + Math.floor(nft.retweets / 15);
        return `
          <div class="nft-card">
            <img src="${nft.image_url || '/placeholder.jpg'}" alt="NFT" class="nft-image"
                 onerror="this.src='https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg'">
            <div class="nft-content">
              <div class="nft-title">${nft.text.substring(0, 80)}...</div>
              <div class="nft-stats">
                <span>❤️ ${nft.likes}</span>
                <span>🔁 ${nft.retweets}</span>
                <span>⭐ ${xp} XP</span>
              </div>
              <div style="margin-top: 10px;">
                <span style="color: #25c2a0; font-weight: bold;">✅ Minted</span>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function loadEligibleMemes(memes) {
      const container = document.getElementById("eligibleMemesGrid");

      if (memes.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #ccc;">No memes eligible for minting. Get 60+ XP on your memes!</div>';
        return;
      }

      container.innerHTML = memes.map(meme => {
        const xp = Math.floor(meme.likes / 10) + Math.floor(meme.retweets / 15);
        return `
          <div class="meme-card">
            <div class="nft-title">${meme.text.substring(0, 100)}...</div>
            <div class="nft-stats">
              <span>❤️ ${meme.likes}</span>
              <span>🔁 ${meme.retweets}</span>
              <span class="meme-xp">⭐ ${xp} XP</span>
            </div>
            <button class="mint-button" onclick="mintNFT('${meme.tweet_id}')">
              ⚡ Mint NFT (500 WALDO)
            </button>
          </div>
        `;
      }).join('');
    }

    function showMintableNFTs() {
      const section = document.getElementById("eligibleMemesSection");
      if (section.style.display === "none") {
        section.style.display = "block";
        section.scrollIntoView({ behavior: 'smooth' });
      } else {
        section.style.display = "none";
      }
    }

    async function mintNFT(tweetId) {
      try {
        const wallet = getWallet();
        if (!wallet) {
          showWaldoNotification("❌ Please connect your wallet first");
          return;
        }

        const res = await fetch(`${baseURL}/api/mint`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ wallet, tweetId })
        });

        const data = await res.json();

        if (data.success) {
          showWaldoNotification("⚡ NFT minting started! Check XUMM to pay fee.");
          if (data.next && data.next.always) {
            window.open(data.next.always, '_blank');
          }

          // Refresh NFT stats after a delay
          setTimeout(loadNFTStats, 5000);
        } else {
          showWaldoNotification(`❌ Mint failed: ${data.error}`);
        }
      } catch (error) {
        console.error("❌ Error minting NFT:", error);
        showWaldoNotification("❌ Error starting NFT mint");
      }
    }

    // DAO Awareness Functions
    async function loadDAOProposalsPreview() {
      try {
        const res = await fetch(`${baseURL}/api/dao/proposals?status=active&limit=3`);
        const data = await res.json();

        const container = document.getElementById('proposalsPreview');
        const countElement = document.getElementById('activeProposalsCount');

        if (data.success && data.proposals.length > 0) {
          // Update count
          countElement.textContent = data.totalProposals;

          // Display proposals
          container.innerHTML = data.proposals.map(proposal => {
            const timeRemaining = proposal.timeRemaining > 0 ?
              Math.ceil(proposal.timeRemaining / (1000 * 60 * 60 * 24)) + ' days left' :
              'Ending soon';

            return `
              <div class="proposal-preview-item">
                <div class="proposal-preview-title">${proposal.title}</div>
                <div class="proposal-preview-meta">
                  <span>${timeRemaining}</span>
                  <span class="proposal-status-badge status-active">ACTIVE</span>
                </div>
              </div>
            `;
          }).join('');
        } else {
          // No active proposals
          countElement.textContent = '0';
          container.innerHTML = `
            <div class="no-proposals">
              <h4>No Active Proposals</h4>
              <p>Check back later for new governance proposals!</p>
            </div>
          `;
        }
      } catch (error) {
        console.error("❌ Error loading DAO proposals preview:", error);
        document.getElementById('proposalsPreview').innerHTML = `
          <div class="no-proposals">
            <h4>Unable to Load Proposals</h4>
            <p>Please try again later</p>
          </div>
        `;
        document.getElementById('activeProposalsCount').textContent = '0';
      }
    }

    // Enhanced Battle System Functions
    async function loadBattleStats() {
      try {
        const res = await fetch(`${baseURL}/api/battle/management/stats`);
        const data = await res.json();

        if (data.success) {
          document.getElementById("totalBattles").textContent = data.stats.totalBattles;
          document.getElementById("activeBattles").textContent = data.stats.activeBattles;
          document.getElementById("totalVotes").textContent = data.stats.totalVotes;
          document.getElementById("totalPrizePool").textContent = `${data.stats.totalPrizePool.toLocaleString()} WALDO`;
        }
      } catch (error) {
        console.error("❌ Error loading battle stats:", error);
      }
    }

    function showBattleTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.battle-tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.battle-tab').forEach(tab => {
        tab.classList.remove('active');
      });

      // Show selected tab
      document.getElementById(`${tabName}BattlesTab`).classList.add('active');
      document.querySelector(`[onclick="showBattleTab('${tabName}')"]`).classList.add('active');

      // Load content for the tab
      if (tabName === 'active') {
        loadActiveBattles();
      } else if (tabName === 'pending') {
        loadPendingBattles();
      } else if (tabName === 'completed') {
        loadCompletedBattles();
      }
    }

    async function loadActiveBattles() {
      try {
        const res = await fetch(`${baseURL}/api/battle/management/active`);
        const data = await res.json();

        const container = document.getElementById("activeBattlesList");

        if (data.success && data.battles.length > 0) {
          container.innerHTML = data.battles.map(battle => `
            <div class="battle-item">
              <div class="battle-memes">
                <div class="battle-meme">
                  <img src="${battle.challengerTweet.image || '/placeholder.jpg'}" alt="Challenger Meme">
                  <div>@${battle.challengerHandle || 'Unknown'}</div>
                </div>
                <div style="font-size: 2rem; margin: 0 20px;">⚔️</div>
                <div class="battle-meme">
                  <img src="${battle.acceptorTweet.image || '/placeholder.jpg'}" alt="Acceptor Meme">
                  <div>@${battle.acceptorHandle || 'Unknown'}</div>
                </div>
              </div>
              <div class="battle-votes">
                <div class="vote-count">${battle.votes.A} vs ${battle.votes.B}</div>
                <div style="margin: 10px 0;">
                  <button class="vote-button" onclick="voteBattle('${battle.battleId}', 'A')">
                    Vote A
                  </button>
                  <button class="vote-button" onclick="voteBattle('${battle.battleId}', 'B')">
                    Vote B
                  </button>
                </div>
                <div style="font-size: 0.8rem; color: #ccc;">
                  ${Math.floor(battle.timeRemaining / (1000 * 60 * 60))}h remaining
                </div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ccc;">No active battles right now. Start one!</div>';
        }
      } catch (error) {
        console.error("❌ Error loading active battles:", error);
        document.getElementById("activeBattlesList").innerHTML = '<div style="color: #fb2f2f;">Error loading battles</div>';
      }
    }

    async function loadPendingBattles() {
      try {
        const res = await fetch(`${baseURL}/api/battle/management/pending`);
        const data = await res.json();

        const container = document.getElementById("pendingBattlesList");

        if (data.success && data.battles.length > 0) {
          container.innerHTML = data.battles.map(battle => `
            <div class="battle-item">
              <div class="battle-memes">
                <div class="battle-meme">
                  <img src="${battle.challengerTweet.image || '/placeholder.jpg'}" alt="Challenger Meme">
                  <div>@${battle.challengerHandle || 'Unknown'}</div>
                  <div style="font-size: 0.8rem; color: #ccc;">${battle.challengerTweet.likes} ❤️ ${battle.challengerTweet.retweets} 🔁</div>
                </div>
                <div style="font-size: 2rem; margin: 0 20px;">⏳</div>
                <div style="text-align: center;">
                  ${battle.openInvite ?
              '<div style="color: #ffcc00;">Open Challenge</div>' :
              `<div>vs @${battle.challengedHandle || 'Specific User'}</div>`
            }
                </div>
              </div>
              <div class="battle-votes">
                ${battle.openInvite ?
              `<button class="vote-button" onclick="acceptBattle('${battle.battleId}')">Accept Challenge</button>` :
              '<div style="color: #ccc;">Waiting for acceptance</div>'
            }
                <div style="font-size: 0.8rem; color: #ccc; margin-top: 5px;">
                  ${Math.floor(battle.timeRemaining / (1000 * 60 * 60))}h to accept
                </div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ccc;">No pending battles</div>';
        }
      } catch (error) {
        console.error("❌ Error loading pending battles:", error);
        document.getElementById("pendingBattlesList").innerHTML = '<div style="color: #fb2f2f;">Error loading battles</div>';
      }
    }

    async function loadCompletedBattles() {
      try {
        const res = await fetch(`${baseURL}/api/battle/management/completed?limit=10`);
        const data = await res.json();

        const container = document.getElementById("completedBattlesList");

        if (data.success && data.battles.length > 0) {
          container.innerHTML = data.battles.map(battle => `
            <div class="battle-item">
              <div class="battle-memes">
                <div class="battle-meme">
                  <img src="${battle.challengerTweet.image || '/placeholder.jpg'}" alt="Challenger Meme">
                  <div>@${battle.challengerHandle || 'Unknown'}</div>
                </div>
                <div style="font-size: 2rem; margin: 0 20px;">
                  ${battle.winner === 'A' ? '🏆' : battle.winner === 'B' ? '💀' : '🤝'}
                </div>
                <div class="battle-meme">
                  <img src="${battle.acceptorTweet.image || '/placeholder.jpg'}" alt="Acceptor Meme">
                  <div>@${battle.acceptorHandle || 'Unknown'}</div>
                </div>
              </div>
              <div class="battle-votes">
                <div class="vote-count">${battle.votes.A} vs ${battle.votes.B}</div>
                <div style="color: ${battle.winner === 'tie' ? '#ffcc00' : '#25c2a0'}; font-weight: bold;">
                  ${battle.winner === 'tie' ? 'TIE' : `Winner: ${battle.winner}`}
                </div>
                <div style="font-size: 0.8rem; color: #ccc;">
                  Prize: ${battle.prizePool.toLocaleString()} WALDO
                </div>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<div style="text-align: center; padding: 40px; color: #ccc;">No completed battles yet</div>';
        }
      } catch (error) {
        console.error("❌ Error loading completed battles:", error);
        document.getElementById("completedBattlesList").innerHTML = '<div style="color: #fb2f2f;">Error loading battles</div>';
      }
    }

    async function voteBattle(battleId, choice) {
      try {
        const wallet = getWallet();
        if (!wallet) {
          showWaldoNotification("❌ Please connect your wallet first");
          return;
        }

        const res = await fetch(`${baseURL}/api/battle/vote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ wallet, battleId, vote: choice })
        });

        const data = await res.json();

        if (data.success) {
          showWaldoNotification("🗳️ Vote submitted! Check XUMM to sign.");
          if (data.next && data.next.always) {
            window.open(data.next.always, '_blank');
          }

          // Refresh active battles after a delay
          setTimeout(loadActiveBattles, 3000);
        } else {
          showWaldoNotification(`❌ Vote failed: ${data.error}`);
        }
      } catch (error) {
        console.error("❌ Error voting in battle:", error);
        showWaldoNotification("❌ Error submitting vote");
      }
    }

    async function acceptBattle(battleId) {
      try {
        const wallet = getWallet();
        const tweetId = document.getElementById("memeTweetId").value;

        if (!wallet) {
          showWaldoNotification("❌ Please connect your wallet first");
          return;
        }

        if (!tweetId) {
          showWaldoNotification("❌ Please enter your meme tweet URL first");
          return;
        }

        const res = await fetch(`${baseURL}/api/battle/accept`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ wallet, tweetId, battleId })
        });

        const data = await res.json();

        if (data.success) {
          showWaldoNotification("⚔️ Battle accepted! Check XUMM to pay fee.");
          if (data.next && data.next.always) {
            window.open(data.next.always, '_blank');
          }

          // Refresh pending battles
          setTimeout(loadPendingBattles, 3000);
        } else {
          showWaldoNotification(`❌ Accept failed: ${data.error}`);
        }
      } catch (error) {
        console.error("❌ Error accepting battle:", error);
        showWaldoNotification("❌ Error accepting battle");
      }
    }

    async function startNewBattle() {
      try {
        const wallet = getWallet();
        const tweetId = document.getElementById("memeTweetId").value;
        const battleType = document.querySelector('input[name="battleType"]:checked').value;
        const challengeHandle = document.getElementById("challengeHandle").value;

        if (!wallet) {
          showWaldoNotification("❌ Please connect your wallet first");
          return;
        }

        if (!tweetId) {
          showWaldoNotification("❌ Please enter your meme tweet URL");
          return;
        }

        if (battleType === 'specific' && !challengeHandle) {
          showWaldoNotification("❌ Please enter the Twitter handle to challenge");
          return;
        }

        const endpoint = battleType === 'specific' ? '/api/battle/start' : '/api/battle/open-start';
        const body = battleType === 'specific'
          ? { wallet, tweetId, twitterHandle: challengeHandle.replace('@', '') }
          : { wallet, tweetId };

        const res = await fetch(`${baseURL}${endpoint}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await res.json();

        if (data.success) {
          showWaldoNotification("🚀 Battle started! Check XUMM to pay fee.");
          if (data.next && data.next.always) {
            window.open(data.next.always, '_blank');
          }

          // Clear form and switch to pending tab
          document.getElementById("memeTweetId").value = '';
          document.getElementById("challengeHandle").value = '';
          setTimeout(() => {
            showBattleTab('pending');
          }, 3000);
        } else {
          showWaldoNotification(`❌ Battle start failed: ${data.error}`);
        }
      } catch (error) {
        console.error("❌ Error starting battle:", error);
        showWaldoNotification("❌ Error starting battle");
      }
    }

    // Handle battle type radio button changes
    document.addEventListener('change', function (e) {
      if (e.target.name === 'battleType') {
        const specificGroup = document.getElementById('specificChallengeGroup');
        if (e.target.value === 'specific') {
          specificGroup.style.display = 'block';
        } else {
          specificGroup.style.display = 'none';
        }
      }
    });

    document.addEventListener("DOMContentLoaded", async () => {
      const wallet = localStorage.getItem("xummWallet");

      if (!wallet) {
        console.warn("⚠️ Wallet not found in localStorage. Redirecting to login...");
        window.location.href = "/connect-wallet/";
        return;
      }

      // ✅ Show wallet address
      const walletDisplay = document.getElementById("walletAddress");
      if (walletDisplay) {
        walletDisplay.textContent = `Wallet: ${wallet}`;
      }

      // ✅ Set up disconnect button
      const disconnectBtn = document.querySelector(".disconnect-btn");
      if (disconnectBtn) {
        disconnectBtn.addEventListener("click", () => {
          console.log("🔌 Disconnecting wallet...");
          localStorage.removeItem("xummWallet");
          location.href = "https://waldocoin.live/";
        });
      }

      // ✅ Continue with WALDO dashboard loading
      try {
        const res = await fetch(`${baseURL}/api/userStats?wallet=${getWallet()}`);
        const data = await res.json();

        document.getElementById("waldoXP").textContent = data.xp;
        document.getElementById("waldoLevel").textContent = `Level ${data.level}`;
        document.getElementById("waldoTitle").textContent = data.title;
        document.getElementById("waldoLikes").textContent = data.likes;
        document.getElementById("waldoRetweets").textContent = data.retweets;
        document.getElementById("waldoMemes").textContent = data.memes;
        document.getElementById("waldoBattles").textContent = data.battles;
        document.getElementById("waldoReferrals").textContent = data.referrals.length;
        document.getElementById("levelProgress").value = Math.min(100, (data.xp % 250));

        // Tweets and charts
        const tweetsRes = await fetch(`${baseURL}/api/tweets?wallet=${getWallet()}`);
        const tweets = (await tweetsRes.json()).filter(t => t.wallet === wallet);

        const totalLikes = tweets.reduce((sum, t) => sum + t.likes, 0);
        const topLikes = Math.max(...tweets.map(t => t.likes), 0);
        const totalEarned = tweets.reduce((sum, t) => sum + (t.waldo_amount || 0), 0);
        const topMeme = tweets.find(t => t.likes === topLikes);

        const tweetData = tweets.map(t => {
          const xp = Math.floor(t.likes / 10) + Math.floor(t.retweets / 15);
          const tier = rewardTiers.slice().reverse().find(rt => t.likes >= rt.likes && t.retweets >= rt.retweets)?.tier || 0;
          return { ...t, xp, tier, url: `https://twitter.com/i/web/status/${t.tweet_id}` };
        });

        renderMemeTable(tweetData);
        document.getElementById("totalLikes").textContent = totalLikes;
        document.getElementById("topMemeLikes").textContent = `${topLikes} likes`;
        document.getElementById("waldoTotalEarnedDisplay").textContent = `${totalEarned.toFixed(2)} WALDO`;
        document.getElementById("activityFeed").innerHTML = tweetData.slice(0, 5).map(t => `<li>Posted meme with ${t.likes} likes, earned ${t.waldo_amount || 0} WALDO</li>`).join("");

        // Top meme card
        document.getElementById("socialHandle").textContent = topMeme?.handle || "@unknown";
        document.getElementById("topMemeImage").src = topMeme?.image_url || "https://waldocoin.live/wp-content/uploads/2025/04/1737843965114.jpg";
        document.getElementById("topMemeLink").href = topMeme ? `https://twitter.com/i/web/status/${topMeme.tweet_id}` : "#";

        // Chart
        const xpSeries = tweetData.map(t => t.xp);
        const labels = tweetData.map((t, i) => `Meme ${i + 1}`);
        new Chart(document.getElementById("xpChart"), {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'XP Gained',
              data: xpSeries,
              borderColor: '#fb2f2f',
              backgroundColor: 'rgba(251,47,47,0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { labels: { color: 'white' } } },
            scales: {
              x: { ticks: { color: 'white' } },
              y: { ticks: { color: 'white' } }
            }
          }
        });

        loadWaldoChart();

        // Initialize enhanced systems
        loadBattleStats();
        loadActiveBattles();
        loadNFTStats();
        loadDAOProposalsPreview();
        updateNavWallet();

        // Refresh intervals
        setInterval(refreshXPStats, 60000);
        setInterval(loadBattleStats, 30000);
        setInterval(loadNFTStats, 120000); // Refresh NFT stats every 2 minutes
        setInterval(loadDAOProposalsPreview, 300000); // Refresh DAO proposals every 5 minutes
        setInterval(() => {
          const activeTab = document.querySelector('.battle-tab.active');
          if (activeTab && activeTab.textContent.includes('Active')) {
            loadActiveBattles();
          }
        }, 15000);

      } catch (err) {
        console.error("❌ Dashboard load failed:", err);
        showWaldoNotification("❌ Could not load dashboard. Check console.");
      }
    });
  </script>
</body>

</html>